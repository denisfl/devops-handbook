# День 7. Архитектура и Будущее

[architecture] [devops] [microservices] [career]

Поздравляю, недельный марафон завершен. Мы научились работать с инструментами, но инструменты — это лишь молоток и зубило. Настоящий DevOps начинается там, где вы перестаете думать командами терминала и начинаете думать системами.
Финальная заметка посвящена архитектуре. Это разговор о том, как не построить систему, которая похоронит под собой команду.

---

## Великий спор: Монолит против Микросервисов

В индустрии существует культ микросервисов. Кажется, что "монолит" — это ругательство. Давайте разберемся, так ли это.

### Монолит: Сила простоты
Монолитная архитектура — это когда всё ваше приложение (фронтенд, бэкенд, админка, биллинг) живет в одном проекте и деплоится одним куском.

*Почему это хорошо?*

1.  **Простота**. `git clone`, `docker-compose up` — и у нового разработчика всё работает.
2.  **Транзакции**. Внутри одной базы данных легко гарантировать целостность (ACID). Либо заказ создан, либо нет.
3.  **Отладка**. Если есть ошибка, она где-то здесь, в этом стеке вызовов.

*Когда это ломается?*
Когда в команде становится 50+ человек. Они начинают толкаться локтями в одном репозитории. Деплой монолита занимает 40 минут. Ошибка в модуле "комментарии к фото" роняет весь интернет-магазин.

### Микросервисы: Цена независимости
Микросервисы — это организационное решение, а не техническое. Вы разбиваете монолит на 20 маленьких сервисов не чтобы сайт работал быстрее (он будет работать медленнее из-за сети!), а чтобы **команды могли бежать быстро и независимо**.
Команда "Поиска" пишет на Python и деплоит 10 раз в день. Команда "Биллинга" пишет на Java и деплоит раз в месяц.

*Цена, которую вы платите*: **Инфраструктурный Ад**.
Вам нужны Service Discovery, Tracing, Circuit Breakers, сложные балансировщики. Вы теряете транзакции (теперь у вас распределенные данные).

*Совет*: Если вы стартап или небольшая команда — **стройте Монолит**. Хороший, модульный монолит. Не занимайтесь "Resume Driven Development".

## Законы распределенных систем

### CAP Теорема
Представьте, что у вас два сервера с базой данных: в Москве и в Нью-Йорке. Между ними порвали кабель (Partition).
Вы не можете одновременно обеспечить:

1.  **Consistency (Согласованность)**: Чтобы данные были одинаковыми там и там.
2.  **Availability (Доступность)**: Чтобы оба сервера отвечали клиентам.

Вам придется выбрать. Либо вы блокируете запись (теряете Доступность), чтобы сохранить данные одинаковыми. Либо вы разрешаете писать в оба сервера (теряете Согласованность), и потом мучительно решаете конфликты.

### Идемпотентность
Самое важное слово на собеседовании.
Идемпотентная операция — это действие, повторение которого не меняет результата.

*   *Плохой API*: `POST /pay` (снимает $10). Если нажать дважды (у пользователя залагал интернет) — спишется $20.
*   *Хороший API*: `POST /pay?request_id=uuid`. Если нажать дважды с тем же ID, сервер скажет: "Друг, я уже обработал этот платеж, всё ок".

В распределенных сетях, где пакеты дублируются и теряются, без идемпотентности вы не построите надежную систему.

---

## 12 Factor App: Манифест

Heroku (пионеры облаков) сформулировали 12 правил идеального приложения. Вот самые важные для DevOps:

1.  **Config**: Конфигурация (пароли, адреса) должна быть отделена от кода. Никаких паролей в Git! Все через переменные окружения (`ENV`).
2.  **Disposability**: Приложение должно быть готово умереть в любую секунду. Не храните состояние (сессии, файлы) внутри контейнера. Храните их в Redis или S3. Это позволяет убивать и перезапускать сервера без боли для пользователей.
3.  **Logs**: Приложение не должно заботиться о том, куда писать логи. Оно просто пишет в `stdout`, а система (Docker/Systemd) забирает поток и сохраняет куда надо.

---

## Куда расти дальше (Roadmap)

Вы освоили базу Junior-специалиста. Ваш путь только начинается.

1.  **CI/CD (GitLab, GitHub Actions)**. Сейчас вы деплоите руками. Ваша цель — сделать конвейер, где `git push` автоматически прогоняет тесты и обновляет сервер.
2.  **Infrastructure as Code (Terraform, Ansible)**. Настраивать сервера руками — моветон. Описывайте инфраструктуру кодом. "Поднять 10 серверов" должно быть одной командой.
3.  **Оркестрация (Kubernetes)**. Когда контейнеров станет 100, Docker Compose перестанет справляться. K8s — это стандарт де-факто для управления флотом контейнеров.
4.  **Clouds (AWS, GCP)**. Железо уходит в прошлое. Учитесь строить системы из "кубиков" облачных провайдеров.

## Ресурсы

*   **[The Phoenix Project](https://itrevolution.com/book/the-phoenix-project/)** — Роман про DevOps. Читается как детектив. Если хотите понять, *зачем* мы всё это делаем — начните отсюда.
*   **[Roadmap.sh/DevOps](https://roadmap.sh/devops)** — Интерактивная карта развития. Не пугайтесь объема, это путь на 5 лет.
*   **[System Design Primer](https://github.com/donnemartin/system-design-primer)** — Лучший репозиторий для подготовки к собеседованиям по архитектуре.

Удачи. Путь инженера бесконечен, и это самое прекрасное в нем.
