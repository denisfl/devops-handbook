# –î–µ–Ω—å 6. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å

[tools] [devops] [monitoring] [observability]

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –≤—ã –ø–∏–ª–æ—Ç —Å–∞–º–æ–ª–µ—Ç–∞. –í—ã –ª–µ—Ç–∏—Ç–µ –≤ –æ–±–ª–∞–∫–∞—Ö. –ï—Å–ª–∏ —É –≤–∞—Å –∑–∞–∫–ª–µ–µ–Ω—ã –ø—Ä–∏–±–æ—Ä—ã, –≤—ã –º–æ–∂–µ—Ç–µ –ª–µ—Ç–µ—Ç—å —Ä–æ–≤–Ω–æ –∫–∞–∫–æ–µ-—Ç–æ –≤—Ä–µ–º—è. –ù–æ –∫–æ–≥–¥–∞ –Ω–∞—á–Ω–µ—Ç—Å—è —Ç—É—Ä–±—É–ª–µ–Ω—Ç–Ω–æ—Å—Ç—å, –≤—ã —Ä–∞–∑–æ–±—å–µ—Ç–µ—Å—å, –¥–∞–∂–µ –Ω–µ –ø–æ–Ω—è–≤, —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ.
–í IT —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ—Ç –∂–µ –ø—Ä–∏–Ω—Ü–∏–ø. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –ª–µ–≥–∫–æ. –°–ª–æ–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –µ–≥–æ —Ä–∞–±–æ—Ç—É –≥–æ–¥–∞–º–∏.
**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** ‚Äî —ç—Ç–æ –ø—Ä–∏–±–æ—Ä–Ω–∞—è –ø–∞–Ω–µ–ª—å –≤–∞—à–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞. –ï–≥–æ —Ü–µ–ª—å –ø—Ä–æ—Å—Ç–∞: –≤—ã –¥–æ–ª–∂–Ω—ã —É–∑–Ω–∞—Ç—å –æ –ø—Ä–æ–±–ª–µ–º–µ —Ä–∞–Ω—å—à–µ, —á–µ–º –≤–∞—à–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–∞—á–Ω—É—Ç –ø–∏—Å–∞—Ç—å –≥–Ω–µ–≤–Ω—ã–µ –ø–æ—Å—Ç—ã –≤ Twitter.

---

## –û—Ç "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞" –∫ "–ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç–∏" (Observability)

–†–∞–Ω—å—à–µ –∞–¥–º–∏–Ω—ã –ø—Ä–æ—Å—Ç–æ –ø–∏–Ω–≥–æ–≤–∞–ª–∏ —Å–µ—Ä–≤–µ—Ä: "–û—Ç–≤–µ—á–∞–µ—Ç? –ó–Ω–∞—á–∏—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç".
–ù–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –≤–µ–± —Å–ª–æ–∂–Ω–µ–µ. –°–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å (–ø–∏–Ω–≥–æ–≤–∞—Ç—å—Å—è), –Ω–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –Ω–∏–º —Ç–æ—Ä–º–æ–∑–∏—Ç, –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –±–µ–ª—ã–π —ç–∫—Ä–∞–Ω 30 —Å–µ–∫—É–Ω–¥. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ `Up`, —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ `Down`.

–ü–æ—ç—Ç–æ–º—É –º—ã –ø–µ—Ä–µ—à–ª–∏ –∫ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ **Observability**, –∫–æ—Ç–æ—Ä–∞—è —Å—Ç–æ–∏—Ç –Ω–∞ —Ç—Ä–µ—Ö –∫–∏—Ç–∞—Ö:

### 1. –õ–æ–≥–∏ (Logs): –ö–æ–Ω—Ç–µ–∫—Å—Ç
–õ–æ–≥ ‚Äî —ç—Ç–æ –¥–Ω–µ–≤–Ω–∏–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ö–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è.
`[2023-10-01 14:00:05] ERROR: Payment declined for user #42 (Insufficient Funds)`
–õ–æ–≥–∏ –±–µ—Å—Ü–µ–Ω–Ω—ã –¥–ª—è **–†–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è (Forensics)**. –ö–æ–≥–¥–∞ —á—Ç–æ-—Ç–æ —É–∂–µ —Å–ª–æ–º–∞–ª–æ—Å—å, –ª–æ–≥–∏ –æ—Ç–≤–µ—á–∞—é—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å "–ü–û–ß–ï–ú–£?". –ù–æ –æ–Ω–∏ –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è –≤ –º–æ–º–µ–Ω—Ç–µ (–Ω–∏–∫—Ç–æ –Ω–µ —á–∏—Ç–∞–µ—Ç –≥–∏–≥–∞–±–∞–π—Ç—ã —Ç–µ–∫—Å—Ç–∞ –≥–ª–∞–∑–∞–º–∏).

### 2. –ú–µ—Ç—Ä–∏–∫–∏ (Metrics): –¢—Ä–µ–Ω–¥—ã
–ú–µ—Ç—Ä–∏–∫–∞ ‚Äî —ç—Ç–æ —Ü–∏—Ñ—Ä–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏.
`CpuUsage: 45%`, `RequestsPerSecond: 120`.
–ú–µ—Ç—Ä–∏–∫–∏ –¥–µ—à–µ–≤—ã –≤ —Ö—Ä–∞–Ω–µ–Ω–∏–∏ (—ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Ä—è–¥—ã —á–∏—Å–µ–ª) –∏ –∏–¥–µ–∞–ª—å–Ω–æ —Ä–∏—Å—É—é—Ç—Å—è –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–∞—Ö.
–û–Ω–∏ –æ—Ç–≤–µ—á–∞—é—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å "–ß–¢–û –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?". –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç —É–≤–∏–¥–µ—Ç—å **–¢—Ä–µ–Ω–¥**: "–°–º–æ—Ç—Ä–∏, –ø–∞–º—è—Ç—å —É—Ç–µ–∫–∞–µ—Ç –ø–æ 100–ú–± –≤ —á–∞—Å, —á–µ—Ä–µ–∑ —Å—É—Ç–∫–∏ –º—ã —É–ø–∞–¥–µ–º". –≠—Ç–æ –¥–∞–µ—Ç –≤–∞–º –≤—Ä–µ–º—è –Ω–∞ —Ä–µ–∞–∫—Ü–∏—é.

### 3. –¢—Ä–µ–π—Å–∏–Ω–≥ (Tracing): –ü—É—Ç—å
–í –º–∏—Ä–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ –æ–¥–∏–Ω –∫–ª–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º–æ–∂–µ—Ç –ø–æ—Ä–æ–¥–∏—Ç—å —Ü–µ–ø–æ—á–∫—É –∏–∑ 50 –≤—ã–∑–æ–≤–æ–≤ —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤. –¢—Ä–µ–π—Å–∏–Ω–≥ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–≤–∏–¥–µ—Ç—å —ç—Ç—É —Ü–µ–ø–æ—á–∫—É –∏ –ø–æ–Ω—è—Ç—å, —á—Ç–æ —Ç–æ—Ä–º–æ–∑–∏—Ç –∏–º–µ–Ω–Ω–æ —Å–µ—Ä–≤–∏—Å "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π", –∞ –Ω–µ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö.

## Push vs Pull: –í–µ—á–Ω—ã–π —Å–ø–æ—Ä

–ö–∞–∫ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ Prometheus –∏–ª–∏ Zabbix)?
‚Äî **Push-–º–æ–¥–µ–ª—å (Zabbix, Graphite)**: –ê–≥–µ–Ω—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å–∞–º "—Å—Ç—É—á–∏—Ç—Å—è" –≤ —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –æ—Ç–¥–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ.
    *–ü–ª—é—Å*: –ü—Ä–æ—â–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∑–∞ —Ñ–∞–µ—Ä–≤–æ–ª–æ–º.
    *–ú–∏–Ω—É—Å*: –ï—Å–ª–∏ –∞–≥–µ–Ω—Ç —Å–æ—à–µ–ª —Å —É–º–∞, –æ–Ω –º–æ–∂–µ—Ç DDOS-–Ω—É—Ç—å —Å–µ—Ä–≤–µ—Ä –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.
‚Äî **Pull-–º–æ–¥–µ–ª—å (Prometheus)**: –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∞–º–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç –∫ –≤–∞—à–∏–º —Å–µ—Ä–≤–∏—Å–∞–º —Ä–∞–∑ –≤ 15 —Å–µ–∫—É–Ω–¥ –∏ –∑–∞–±–∏—Ä–∞–µ—Ç (—Å–∫—Ä–µ–π–ø–∏—Ç) –¥–∞–Ω–Ω—ã–µ.
    *–ü–ª—é—Å*: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å. –í—ã –∑–Ω–∞–µ—Ç–µ, —á—Ç–æ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç ‚Äî –∑–Ω–∞—á–∏—Ç —Å–µ—Ä–≤–∏—Å —É–º–µ—Ä –∏–ª–∏ —Å–µ—Ç—å —É–ø–∞–ª–∞. (–≠—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç –∏–Ω–¥—É—Å—Ç—Ä–∏–∏ —Å–µ–π—á–∞—Å).

---

## –ü—Ä–∞–∫—Ç–∏–∫–∞

### 1. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã "–∑–¥–µ—Å—å –∏ —Å–µ–π—á–∞—Å"
–ü—Ä–µ–∂–¥–µ —á–µ–º —Å—Ç–∞–≤–∏—Ç—å —Å–ª–æ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã, –Ω–∞—É—á–∏–º—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º–∏.
‚Äî `htop`: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –¥–∏—Å–ø–µ—Ç—á–µ—Ä. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –ø–æ —è–¥—Ä–∞–º –∏ –∫—Ç–æ –µ—Å—Ç –ø–∞–º—è—Ç—å.
‚Äî `df -h`: (Disk Free). –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ. –°–∞–º–∞—è —á–∞—Å—Ç–∞—è –ø—Ä–∏—á–∏–Ω–∞ –ø–∞–¥–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–æ–≤ ‚Äî –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –ª–æ–≥–∞–º–∏ –¥–∏—Å–∫.
‚Äî `docker stats`: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

### 2. –ü–∏—à–µ–º —Å–≤–æ–π Watchdog –Ω–∞ Python
–ù–∞–ø–∏—à–µ–º —Å–∫—Ä–∏–ø—Ç-—Å—Ç–æ—Ä–æ–∂, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —ç–º—É–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –∞–≥–µ–Ω—Ç–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞. –û–Ω –ø—Ä–æ–≤–µ—Ä–∏—Ç –¥–∏—Å–∫ –∏, –µ—Å–ª–∏ –º–µ—Å—Ç–∞ –º–∞–ª–æ, –ø–æ–¥–Ω–∏–º–µ—Ç —Ç—Ä–µ–≤–æ–≥—É.

`watchdog.py`:
```python
import shutil
import sys

# –ü–æ—Ä–æ–≥ —Ç—Ä–µ–≤–æ–≥–∏ (–ì–∏–≥–∞–±–∞–π—Ç—ã)
THRESHOLD_GB = 10

def check_disk():
    # –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∫–æ—Ä–Ω—é "/"
    total, used, free = shutil.disk_usage("/")
    
    # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –±–∞–π—Ç—ã –≤ –ì–± (–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ 1024^3)
    free_gb = free // (2**30)
    
    print(f"Disk Status: {free_gb} GB free")
    
    if free_gb < THRESHOLD_GB:
        print(f"üö® ALARM! Free space is critically low (<{THRESHOLD_GB}GB)!")
        # –ö–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞ 1 —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º–µ –æ–± –æ—à–∏–±–∫–µ
        sys.exit(1)
    else:
        print("‚úÖ System Healthy")
        sys.exit(0)

if __name__ == "__main__":
    check_disk()
```

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è: Cron
–°–∫—Ä–∏–ø—Ç –ø–æ–ª–µ–∑–µ–Ω, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–∞–º. –ò—Å–ø–æ–ª—å–∑—É–µ–º **Cron** ‚Äî –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á Linux.
–ó–∞–¥–∞—á–∞: –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É –∏ –ø–∏—Å–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ª–æ–≥.

1.  –û—Ç–∫—Ä–æ–π—Ç–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä –∫—Ä–æ–Ω—Ç–∞–±–∞:
    ```bash
    crontab -e
    ```
2.  –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞:
    ```bash
    # m h  dom mon dow   command
    * * * * * /usr/bin/python3 /–ø—É—Ç—å/–¥–æ/watchdog.py >> /tmp/watchdog.log 2>&1
    ```
    (–ó–∞–º–µ–Ω–∏—Ç–µ –ø—É—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π. `2>&1` –æ–∑–Ω–∞—á–∞–µ—Ç "–ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å –æ—à–∏–±–∫–∏ —Ç—É–¥–∞ –∂–µ, –∫—É–¥–∞ –∏ –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç").

3.  –ü–æ–¥–æ–∂–¥–∏—Ç–µ –º–∏–Ω—É—Ç—É –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥:
    ```bash
    tail -f /tmp/watchdog.log
    ```

---

## –†–µ—Å—É—Ä—Å—ã

‚Äî **[Site Reliability Engineering (Google Books)](https://sre.google/books/)** ‚Äî –≠—Ç–æ –±–∏–±–ª–∏—è. –ì–ª–∞–≤—ã –ø—Ä–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±—ä—è—Å–Ω—è—é—Ç —Ñ–∏–ª–æ—Å–æ—Ñ–∏—é: "–ó–∞—á–µ–º –±—É–¥–∏—Ç—å –∏–Ω–∂–µ–Ω–µ—Ä–∞ –Ω–æ—á—å—é?". –ï—Å–ª–∏ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –∞–ª–µ—Ä—Ç –Ω–µ –Ω—É–∂–µ–Ω.
‚Äî **[Prometheus Documentation](https://prometheus.io/docs/introduction/overview/)** ‚Äî –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ –¥–µ-—Ñ–∞–∫—Ç–æ –¥–ª—è —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫.
‚Äî **[Grafana Playground](https://play.grafana.org/)** ‚Äî –ü–æ—Ç—ã–∫–∞–π—Ç–µ –∂–∏–≤—ã–µ –¥–∞—à–±–æ—Ä–¥—ã, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –∫–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç —Ö–æ—Ä–æ—à–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥.
